<!DOCTYPE html>
<html lang="en-us">

<head>
  <title>MetingJS&#43;p5.js音频可视化 | 🌻Chilling...</title>

  <meta charset="UTF-8">
  <meta name="language" content="en">
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  
  
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="MetingJS&#43;p5.js音频可视化" />
  <meta name="twitter:description" content=""/>
  <meta name="twitter:site" content="https://twitter.com/AnmoWu" />
  <meta name="twitter:creator" content="https://twitter.com/AnmoWu" />
  

  <link rel="shortcut icon" type="image/png" href="/favicon.ico" />

  

  
  
  
    
	
 
  
  
  
  
  
  
    
    <link type="text/css" id="shit" rel="stylesheet" href="/css/post.min.17bd8b5e62c85da95507669f8be988e62190d552bf242c1743e2a2a63279517d.css" integrity="sha256-F72LXmLIXalVB2afi&#43;mI5iGQ1VK/JCwXQ&#43;KipjJ5UX0="/>
  
    
    <link type="text/css" id="shit" rel="stylesheet" href="/css/custom.min.7ebcb204d2f117bc158a5adfe99f70c3e953614a0a4fc3ac6d45c699ae23f260.css" integrity="sha256-fryyBNLxF7wVilrf6Z9ww&#43;lTYUoKT8OsbUXGma4j8mA="/>
  
  
  
  

  
   
   
  
<script type="application/ld+json">
  
    {
      "@context" : "http://schema.org",
      "@type" : "BlogPosting",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https:\/\/anmowu.github.io\/"
      },
      "articleSection" : "blog",
      "name" : "MetingJS\u002bp5.js音频可视化 | Anmo's Test",
      "headline" : "MetingJS\u002bp5.js音频可视化",
      "description" : "",
      "inLanguage" : "en-US",
      "author" : "",
      "copyrightYear" : "282819",
      "datePublished": "2024-06-28 17:19:22 \u002b0800 CST",
      "dateModified" : "2024-06-28 17:19:22 \u002b0800 CST",
      "url" : "https:\/\/anmowu.github.io\/blog\/visualization\/",
      "wordCount" : "1065"
    }
  
</script>
<meta name="google-site-verification" content="-OTnOSW4EWTYe4QUCBdOjNbGJ5i3FCkL9s9jINT7FV0" />
</head>

<body>

  <div id="darkMode" class="darkMode">
    <input class="darkmode" type="checkbox" id="darkToggle" onchange="toggleDarkMode()">
  </div>
  
  <div class="burger__container">
  <div class="burger" aria-controls="navigation" aria-label="Menu">
    <div class="burger__meat burger__meat--1"></div>
    <div class="burger__meat burger__meat--2"></div>
    <div class="burger__meat burger__meat--3"></div>
  </div>
</div>
 

  <nav class="nav" id="navigation">
  <ul class="nav__list">
    
    
      <li>
        <a  href="/life">☂️in life</a>
      </li>
    
      <li>
        <a  class="active"
         href="/blog">🍇blogs</a>
      </li>
    
      <li>
        <a  href="/">🔮about</a>
      </li>
    
  </ul>
  
</nav>



<script src="/js/love.js"></script>




  
  
  
  <main>
  
    
    

    
	
   

	
	<div class="flex-wrapper">
	  
      <div class="post__container">
	    
        <div class="post">
		<div id="progress-bar"></div>
          <header class="post__header">
            <h1 id="post__title">MetingJS&#43;p5.js音频可视化</h1>
			<time datetime="2024-06-28 17:19:22 &#43;0800 CST" class="post__date">Jun 28 2024</time>
			
			<br><span id="busuanzi_container_page_pv" style="color:#9b9b9b; font-size: 0.8rem;">
            👀 <span id="busuanzi_value_page_pv"></span> times

            </span>
	        <span style="color:#9b9b9b; font-size: 0.8rem;">&nbsp;🖊️1065 words</span>
            
			
		  </header>
		  
          <article class="post__content">
              
<h2 id="构思">构思<a class="anchor" href="#构思">#</a></h2>
<p>由于页面太空荡，就萌生了添加点动态效果的想法。之前试图实现音乐全局播放，但遇到css的硬问题，没法解决，除非舍弃模块化。
所以改成一页一首或一列表的主题曲，采用<code>MetingJS</code>+<code>APlayer</code>，封装在<code>audio.html</code>里，在页首进行选曲。</p>
<p>在博客建立之初想要在背景加入心电图式样的音频可视化效果，但经过测试，实际与心电图相差甚远，遂试图加入<code>p5.js</code>或者<code>Processing</code>的码绘效果。</p>
<h2 id="弯路">弯路<a class="anchor" href="#弯路">#</a></h2>
<p>根据教程很快写出了本地mp3的p5.js音频可视化，但在MetingJS也就是外链播放源的转接上，走了很多弯路。</p>
<p>首先，我想到了开发者工具里经常使用的网络-媒体下载mp3的功能，希望捕捉当前外链播放器的api链接或者直接获取mp3。</p>
<p>现在看来，这一步就不太聪明。且不说模仿外部抓包很难实现，即使获取了，可视化和音乐源的播放也是两个进程，无法精准同步和控制。</p>
<p>在这里我查询了MetingJS的官方文档，写得很简略，没看懂。于是返回看源代码，做了几个<code>this.aplayer</code>的调用输出测试，发现创建语句存在一定问题，输出为<code>undefined</code>。</p>
<p>因此修改了<code>Meting.min.js</code>对于APlayer的创建语句，直接单起一行，独立出来。现在看控制台，还能追忆当时混乱的测试输出之情状。</p>
<p>那么进入下个阶段，一切操作都基于MetingJS已经加载完APlayer相关组件，所以最后要加一个加载完毕的事件触发<code>this.dispatchEvent(new Event('aplayerload'))</code>。</p>
<p>触发后，防止audio标签的跨域问题，需要修改<code>ap.audio.crossOrigin = &quot;anonymous</code>。</p>
<p>获取到<code>audioContext</code>后，需要添加<code>audioContext.resume()</code>以避免浏览器因为自动播放禁令无法加载音频内容。
但是似乎没有什么用，依然时不时报错，不过不影响实际效果。</p>
<p>最后获取音乐源时，设置flag进行单次处理防止反复获取audioContext的冗余操作。</p>
<p>以上基本是我走过的小小弯路。</p>
<h2 id="最终效果">最终效果<a class="anchor" href="#最终效果">#</a></h2>
<p>PC端点击左下角的播放器按钮就可以看见啦！源代码开控制台，<code>Visualization.js</code>。</p>
<p>注意，此处<code>Meting.min.js</code>和<code>APlayer.min.js</code>都进行了修改。</p>
<p>之后希望引入更多可视化效果，包括Processing相关、perlin noise的海浪波动，以及理想中的心电图样式！</p>
<p>下一步准备着手文章代码块的添加与美化实现。还有sitemap里这个空categories页面究竟是干嘛的？主题作者能不能回答一下&hellip;</p>


              
			  
                  <!DOCTYPE html>
<html>
	<head>
		
        <link rel="stylesheet" href="/css/APlayer.min.css">
        <script src="/js/APlayer.min.js"></script>
        
        <script src="/js/Meting.min.js"></script>
	    
        <script src='https://cdn.bootcdn.net/ajax/libs/jquery/1.8.3/jquery.min.js'></script>
        <script src='https://cdn.bootcdn.net/ajax/libs/jquery.pjax/2.0.1/jquery.pjax.min.js'></script>
		
		<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.6.0/addons/p5.sound.js"></script>
	    
		

		

	</head>
	<body>
		<div id="player">

			<meting-js server="netease" 
			type="song" 
			id="2107565588" 
			fixed="true"
				autoplay="false" loop="all" order="random" preload="auto" list-folded="ture" list-max-height="400px"
				lrc-type="0" theme="#540f90">
			</meting-js>
			<script>
			console.log("type:", "song");
            console.log("id: ",  2107565588 );
            </script>
		</div>
	</body>
	<script src="/js/Visualization.js"></script>
	
</html>
	          
          </article>
		 
          

<ul class="tags__list">
    
    <li class="tag__item">
        <a class="tag__link" href="https://anmowu.github.io/tags/test/">Test</a>
    </li></ul>

 <div class="pagination">
  
    <a class="pagination__item" href="https://anmowu.github.io/blog/brand-new-start/">
        <span class="pagination__label">Previous Post</span>
        <span class="pagination__title">New Start🟪</span>
    </a>
  

  
</div>

          
          <footer class="post__footer">
            
            


<div class="social-icons">
  
     
    
      <a
        class="social-icons__link"
        title="Twitter"
        href="https://twitter.com/AnmoWu"
        target="_blank"
        rel="me noopener"
      >
        <div class="social-icons__icon" style="background-image: url('https://anmowu.github.io/svg/twitter.svg')"></div>
      </a>
    
  
     
    
      <a
        class="social-icons__link"
        title="GitHub"
        href="https://github.com/AnmoWu/"
        target="_blank"
        rel="me noopener"
      >
        <div class="social-icons__icon" style="background-image: url('https://anmowu.github.io/svg/github.svg')"></div>
      </a>
    
  
     
    
      <a
        class="social-icons__link"
        title="Email"
        href="mailto:X3.141592653@outlook.com/"
        target="_blank"
        rel="me noopener"
      >
        <div class="social-icons__icon" style="background-image: url('https://anmowu.github.io/svg/email.svg')"></div>
      </a>
    
     
</div>

            <p>© 2024 Anmo</p>
          </footer>
          </div>
      </div>
      
      <div class="toc-container">
          
        <nav id="TableOfContents">
  <ul>
    <li><a href="#构思">构思</a></li>
    <li><a href="#弯路">弯路</a></li>
    <li><a href="#最终效果">最终效果</a></li>
  </ul>
</nav>
      </div>
      
    </div>
	
	
    

  </main>
 
   
  
  
  <script src="/js/index.min.fa812d7b6cd9cbb1b6c717a0fe62b426ebb989bc88f4e7709ab16ad048858a6a.js" integrity="sha256-&#43;oEte2zZy7G2xxeg/mK0Juu5ibyI9OdwmrFq0EiFimo=" crossorigin="anonymous"></script>
  
  <script src="/js/progress-bar.js"></script>
  
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  
  <script src="https://unpkg.com/prismjs@1.20.0/components/prism-core.min.js"></script>

  
  <script src="https://unpkg.com/prismjs@1.20.0/plugins/autoloader/prism-autoloader.min.js"
    data-autoloader-path="https://unpkg.com/prismjs@1.20.0/components/"></script>

  
    <script src="/js/table-of-contents.js"></script>
  


  <script src="/js/fucknight.js"></script>
  
 
  
  
  
  
</body>

</html>
